<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Уютное Sudoku</title>
    
</head>

<body>
    
    <script>
        // Инициализация игры
        document.addEventListener('DOMContentLoaded', function () {
            const game = {
                grid: [],
                solution: [],
                difficulty: 'easy',
                selectedCell: null,
                mistakes: 0,
                timer: 0,
                timerInterval: null,
                completed: false,

                init() {
                    this.generateGrid();
                    this.startTimer();
                    this.setupEventListeners();
                },

                generateGrid() {
                    // В реальном приложении здесь будет запрос к бэкенду
                    // Для демонстрации создаем простую сетку
                    const gridElement = document.getElementById('sudoku-grid');
                    gridElement.innerHTML = '';

                    // Пример простой сетки
                    this.grid = [
                        [5, 3, 0, 0, 7, 0, 0, 0, 0],
                        [6, 0, 0, 1, 9, 5, 0, 0, 0],
                        [0, 9, 8, 0, 0, 0, 0, 6, 0],
                        [8, 0, 0, 0, 6, 0, 0, 0, 3],
                        [4, 0, 0, 8, 0, 3, 0, 0, 1],
                        [7, 0, 0, 0, 2, 0, 0, 0, 6],
                        [0, 6, 0, 0, 0, 0, 2, 8, 0],
                        [0, 0, 0, 4, 1, 9, 0, 0, 5],
                        [0, 0, 0, 0, 8, 0, 0, 7, 9]
                    ];

                    // Заполняем сетку
                    for (let i = 0; i < 9; i++) {
                        for (let j = 0; j < 9; j++) {
                            const cell = document.createElement('div');
                            cell.className = 'cell';
                            cell.dataset.row = i;
                            cell.dataset.col = j;

                            // Добавляем границы для блоков 3x3
                            if ((j + 1) % 3 === 0 && j !== 8) {
                                cell.classList.add('border-right-3');
                            }
                            if ((i + 1) % 3 === 0 && i !== 8) {
                                cell.classList.add('border-bottom-3');
                            }

                            if (this.grid[i][j] !== 0) {
                                cell.textContent = this.grid[i][j];
                                cell.classList.add('fixed');
                            }

                            gridElement.appendChild(cell);
                        }
                    }
                },

                startTimer() {
                    clearInterval(this.timerInterval);
                    this.timer = 0;
                    this.updateTimer();

                    this.timerInterval = setInterval(() => {
                        this.timer++;
                        this.updateTimer();
                    }, 1000);
                },

                updateTimer() {
                    const minutes = Math.floor(this.timer / 60);
                    const seconds = this.timer % 60;
                    document.getElementById('timer').textContent =
                        `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                },

                setupEventListeners() {
                    // Выбор ячейки
                    document.getElementById('sudoku-grid').addEventListener('click', (e) => {
                        const cell = e.target;
                        if (cell.classList.contains('cell') && !cell.classList.contains('fixed')) {
                            this.selectCell(cell);
                        }
                    });

                    // Кнопки цифр
                    document.querySelectorAll('.number-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            if (this.selectedCell) {
                                const value = parseInt(btn.dataset.value);
                                this.setCellValue(value);
                            }
                        });
                    });

                    // Кнопка рестарта
                    document.getElementById('restart-btn').addEventListener('click', () => {
                        this.restartGame();
                    });

                    // Выбор сложности
                    document.querySelectorAll('.difficulty-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.difficulty-btn').forEach(b => {
                                b.classList.remove('active');
                            });
                            btn.classList.add('active');
                            this.difficulty = btn.dataset.difficulty;
                            this.restartGame();
                        });
                    });

                    // Управление с клавиатуры
                    document.addEventListener('keydown', (e) => {
                        if (this.selectedCell && e.key >= '1' && e.key <= '9') {
                            this.setCellValue(parseInt(e.key));
                        } else if (this.selectedCell && e.key === 'Backspace') {
                            this.setCellValue(0);
                        }
                    });
                },

                selectCell(cell) {
                    // Снимаем выделение с предыдущей ячейки
                    if (this.selectedCell) {
                        this.selectedCell.classList.remove('selected');
                    }

                    // Выделяем новую ячейку
                    cell.classList.add('selected');
                    this.selectedCell = cell;
                },

                setCellValue(value) {
                    if (!this.selectedCell || this.completed) return;

                    const row = parseInt(this.selectedCell.dataset.row);
                    const col = parseInt(this.selectedCell.dataset.col);

                    if (value === 0) {
                        // Очистка ячейки
                        this.selectedCell.textContent = '';
                        this.selectedCell.classList.remove('error');
                        this.grid[row][col] = 0;
                    } else {
                        // Установка значения
                        this.selectedCell.textContent = value;
                        this.grid[row][col] = value;

                        // Проверка правильности (в реальном приложении будет проверка с решением)
                        // Здесь просто случайная проверка для демонстрации
                        if (Math.random() > 0.7) {
                            this.selectedCell.classList.add('error');
                            this.mistakes++;
                            document.getElementById('mistakes').textContent = this.mistakes;
                        } else {
                            this.selectedCell.classList.remove('error');
                        }

                        // Проверка завершения игры
                        this.checkCompletion();
                    }
                },

                checkCompletion() {
                    // В реальном приложении здесь будет проверка с решением
                    // Для демонстрации просто проверяем, что все клетки заполнены
                    for (let i = 0; i < 9; i++) {
                        for (let j = 0; j < 9; j++) {
                            if (this.grid[i][j] === 0) return;
                        }
                    }

                    this.completed = true;
                    clearInterval(this.timerInterval);
                    this.showMessage('Поздравляем! Вы решили головоломку!', 'success');
                },

                showMessage(text, type) {
                    const messageEl = document.getElementById('message');
                    messageEl.textContent = text;
                    messageEl.className = `game-message ${type}`;

                    setTimeout(() => {
                        messageEl.className = 'game-message';
                    }, 3000);
                },

                restartGame() {
                    clearInterval(this.timerInterval);
                    this.mistakes = 0;
                    this.completed = false;
                    document.getElementById('mistakes').textContent = '0';
                    this.generateGrid();
                    this.startTimer();
                    this.showMessage('Новая игра началась!', 'success');
                }
            };

            // Запускаем игру
            game.init();
        });
    </script>
</body>

</html>